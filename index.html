<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹/æ˜“ä¸åœ°æ”¿ - å°ˆæ¥­æ–‡ä»¶ç”Ÿæˆå™¨ (çµ‚æ¥µç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#1a3c5e',
                        'brand-gold': '#c49a6c',
                        'brand-gray': '#f4f4f5',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Noto Serif TC"', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { overflow: hidden; background-color: #2d3748; }
        
        /* ç·¨è¼¯å€æ»¾å‹•æ¢ */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #edf2f7; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 3px; }

        /* A4 ç´™å¼µè¨­å®š */
        .a4-paper {
            width: 210mm;
            height: 297mm; /* å¼·åˆ¶å›ºå®š A4 é«˜åº¦ */
            background: white;
            margin: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* é˜²æ­¢å…§å®¹æº¢å‡º */
            transition: all 0.3s ease;
        }

        /* é è¦½èƒŒæ™¯ç¶²æ ¼ */
        .preview-area {
            background-image: 
                linear-gradient(45deg, #3a4149 25%, transparent 25%), 
                linear-gradient(-45deg, #3a4149 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #3a4149 75%), 
                linear-gradient(-45deg, transparent 75%, #3a4149 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* é–‹é—œæ¨£å¼ */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #c49a6c;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #c49a6c;
        }
        
        /* åˆ—å°èˆ‡åŒ¯å‡ºæ™‚éš±è—éå¿…è¦å…ƒç´  */
        @media print {
            body * { visibility: hidden; }
            #document-preview, #document-preview * { visibility: visible; }
            #document-preview { position: absolute; left: 0; top: 0; margin: 0; box-shadow: none; }
        }
    </style>
</head>
<body class="h-screen flex flex-col text-gray-800">

    <header class="bg-brand-dark text-white h-14 flex items-center justify-between px-6 shrink-0 shadow-lg z-30">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 bg-brand-gold rounded flex items-center justify-center font-serif font-bold text-brand-dark">H</div>
            <h1 class="font-medium tracking-wider text-sm sm:text-base">æ–‡ä»¶ç”Ÿæˆç³»çµ± <span class="opacity-50 mx-2">|</span> å®åœ‹åœ°æ”¿ / æ˜“ä¸åœ°æ”¿</h1>
        </div>
        <div class="flex gap-3">
            <button onclick="downloadImage()" class="flex items-center gap-2 px-4 py-1.5 bg-white/10 hover:bg-white/20 rounded text-sm transition border border-white/10">
                <span>ğŸ“· JPG</span>
            </button>
            <button onclick="downloadPDF()" class="flex items-center gap-2 px-4 py-1.5 bg-brand-gold hover:bg-[#b08d55] text-white font-medium rounded text-sm transition shadow-md">
                <span>ğŸ“„ PDF</span>
            </button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <aside class="w-full md:w-[400px] bg-white border-r border-gray-200 flex flex-col z-20 shadow-xl">
            <div class="p-4 bg-gray-50 border-b flex items-center gap-2 font-bold text-gray-700">
                <span>âš™ï¸</span> ç·¨è¼¯èˆ‡è¨­å®š
            </div>
            
            <div class="flex-1 overflow-y-auto custom-scroll p-6 space-y-8">
                
                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">Logo è¨­å®š</h3>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="relative group">
                            <label class="block text-xs font-bold text-gray-600 mb-1">å·¦å´ Logo (æ˜“ä¸)</label>
                            <label class="cursor-pointer flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                <span class="text-xs text-gray-400">é»æ“Šä¸Šå‚³</span>
                                <input type="file" id="upload-logo-left" accept="image/*" class="hidden" onchange="previewImage(this, 'logo-left-img')">
                            </label>
                        </div>

                        <div class="relative">
                            <label class="block text-xs font-bold text-gray-600 mb-1">å³å´ Logo (å®åœ‹)</label>
                            <label class="cursor-pointer flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                <span class="text-xs text-gray-400">é»æ“Šä¸Šå‚³</span>
                                <input type="file" id="upload-logo-right" accept="image/*" class="hidden" onchange="previewImage(this, 'logo-right-img')">
                            </label>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100">

                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">æ–‡æ¡ˆå…§å®¹</h3>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">æ–‡ä»¶æ¨™é¡Œ</label>
                        <input type="text" id="input-title" class="w-full p-2 bg-gray-50 border border-gray-200 rounded focus:border-brand-gold focus:ring-1 focus:ring-brand-gold outline-none transition" value="å¹³å‡åœ°æ¬Šæ¢ä¾‹ä¿®æ³•é‡é»è§£æ">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">å‰¯æ¨™é¡Œ / æ—¥æœŸ</label>
                        <input type="text" id="input-subtitle" class="w-full p-2 bg-gray-50 border border-gray-200 rounded focus:border-brand-gold focus:ring-1 focus:ring-brand-gold outline-none transition" value="ä¸­è¯æ°‘åœ‹ 115 å¹´ 1 æœˆ 2 æ—¥ | æ”¿ç­–å½±éŸ¿åˆ†æ">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">å…§æ–‡ (æ”¯æ´æ›è¡Œ)</label>
                        <textarea id="input-content" rows="12" class="w-full p-3 bg-gray-50 border border-gray-200 rounded focus:border-brand-gold focus:ring-1 focus:ring-brand-gold outline-none transition text-sm leading-relaxed" placeholder="è«‹è¼¸å…¥å…§å®¹...">æœ¬æ¬¡ä¿®æ³•ä¸»è¦é‡å°é å”®å±‹æ›ç´„è½‰å”®é™åˆ¶ã€ç§æ³•äººè³¼å±‹è¨±å¯åˆ¶ç­‰äº”å¤§é‡é»é€²è¡Œè¦ç¯„ã€‚

é‡å°ç§æ³•äººè³¼å±‹éƒ¨åˆ†ï¼ŒåŸå‰‡ä¸Šå°‡æ”¹æ¡è¨±å¯åˆ¶ï¼Œä¸¦é™åˆ¶å–å¾—å¾Œäº”å¹´å…§ä¸å¾—ç§»è½‰ï¼Œæ­¤èˆ‰é æœŸå°‡å¤§å¹…é™ä½è±ªå®…å¸‚å ´çš„æŠ•è³‡éœ€æ±‚ã€‚

å°æ–¼ä¸€èˆ¬è‡ªä½å®¢ç¾¤è€Œè¨€ï¼Œå¸‚å ´ä¾›çµ¦é‡å¯èƒ½æœƒå› ç‚ºæŠ•è³‡å®¢é€€å ´è€ŒçŸ­æœŸæ³¢å‹•ï¼Œä½†é•·æœŸæœ‰åŠ©æ–¼æˆ¿åƒ¹å›æ­¸ç†æ€§åŸºæœ¬é¢ã€‚å®åœ‹èˆ‡æ˜“ä¸åœ°æ”¿åœ˜éšŠå»ºè­°ï¼Œç›®å‰æŒæœ‰é å”®å±‹ä¹‹å®¢æˆ¶ï¼Œæ‡‰é‡æ–°æª¢è¦–è³‡ç”¢é…ç½®ï¼Œé¿å…é•è¦è½‰å”®å—ç½°ã€‚</textarea>
                    </div>
                </div>

                <hr class="border-gray-100">

                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-bold text-brand-dark flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" /><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" /></svg>
                            é¡¯ç¤ºæ•¸æ“šåœ–è¡¨
                        </span>
                        
                        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                            <input type="checkbox" id="toggle-chart" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer checked:right-0 checked:border-brand-gold transition-all duration-300 z-10" checked>
                            <label for="toggle-chart" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer checked:bg-brand-gold transition-all duration-300"></label>
                        </div>
                    </div>

                    <div id="chart-controls" class="space-y-3 transition-all duration-300">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="chart-label-1" class="p-2 border rounded text-xs" value="è‡ªä½éœ€æ±‚">
                            <input type="number" id="chart-data-1" class="p-2 border rounded text-xs" value="65">
                            <input type="text" id="chart-label-2" class="p-2 border rounded text-xs" value="æŠ•è³‡éœ€æ±‚">
                            <input type="number" id="chart-data-2" class="p-2 border rounded text-xs" value="35">
                        </div>
                        <input type="text" id="chart-caption" class="w-full p-2 border rounded text-xs" value="åœ–è¡¨ 1ï¼šä¿®æ³•å‰å¾Œå¸‚å ´çµæ§‹é ä¼°ä½”æ¯”">
                    </div>
                </div>

            </div>
        </aside>

        <main class="flex-1 preview-area overflow-auto flex justify-center py-8 px-4">
            
            <div id="document-preview" class="a4-paper shrink-0 text-brand-dark">
                
                <header class="px-12 py-10 flex justify-between items-end border-b-[3px] border-brand-gold bg-white">
                    <div class="flex items-center h-16 gap-6">
                        <img id="logo-left-img" src="" alt="å·¦å´Logo" class="h-full w-auto object-contain hidden">
                        <div id="logo-left-placeholder" class="h-full w-32 bg-gray-100 rounded border border-dashed border-gray-300 flex items-center justify-center text-xs text-gray-400">
                            Logo 1 (è«‹ä¸Šå‚³)
                        </div>

                        <div class="h-10 w-px bg-gray-300 mx-2"></div>

                        <img id="logo-right-img" src="" alt="å³å´Logo" class="h-full w-auto object-contain hidden">
                        <div id="logo-right-placeholder" class="h-full w-32 bg-gray-100 rounded border border-dashed border-gray-300 flex items-center justify-center text-xs text-gray-400">
                            Logo 2 (è«‹ä¸Šå‚³)
                        </div>
                    </div>

                    <div class="text-right">
                        <h2 class="font-serif font-bold text-xl tracking-widest text-brand-dark">å®åœ‹ / æ˜“ä¸åœ°æ”¿</h2>
                        <div class="text-[10px] tracking-[0.2em] text-gray-500 uppercase mt-1">Professional Land Administration</div>
                    </div>
                </header>

                <article class="flex-1 px-14 py-12 flex flex-col">
                    
                    <div class="text-center mb-10">
                        <h1 id="preview-title" class="text-4xl font-serif font-bold text-brand-dark mb-4">å¹³å‡åœ°æ¬Šæ¢ä¾‹ä¿®æ³•é‡é»è§£æ</h1>
                        <div class="inline-block border-t border-b border-brand-gold/30 py-2 px-6">
                            <p id="preview-subtitle" class="text-sm text-gray-500 tracking-wide font-medium">ä¸­è¯æ°‘åœ‹ 115 å¹´ 1 æœˆ 2 æ—¥ | æ”¿ç­–å½±éŸ¿åˆ†æ</p>
                        </div>
                    </div>

                    <div id="preview-content-container" class="flex-1 transition-all duration-500 ease-in-out">
                         <div id="preview-content" class="text-justify text-gray-700 text-base leading-relaxed whitespace-pre-wrap font-sans">
                            </div>
                    </div>

                    <div id="preview-chart-section" class="mt-8 mb-4 bg-gray-50 p-6 rounded-xl border border-gray-100 shadow-sm">
                        <div class="flex flex-col items-center justify-center">
                            <h3 class="text-brand-gold font-bold text-sm mb-4 uppercase tracking-widest border-b border-brand-gold/20 pb-1">Data Analysis</h3>
                            <div class="relative h-56 w-full max-w-sm">
                                <canvas id="impactChart"></canvas>
                            </div>
                            <p id="preview-chart-caption" class="text-xs text-gray-500 mt-3 italic font-serif">åœ–è¡¨ 1ï¼šæ•¸æ“šåˆ†æèªªæ˜</p>
                        </div>
                    </div>

                </article>

                <footer class="bg-brand-dark text-white text-center py-4 text-xs opacity-90 mt-auto">
                    <p class="mb-1 font-light tracking-wider">å®åœ‹åœ°æ”¿ â€§ æ˜“ä¸åœ°æ”¿å£«äº‹å‹™æ‰€ â€§ è¯åˆè£½ä½œ</p>
                    <p class="text-[10px] opacity-50 font-sans">Copyright Â© All Rights Reserved. æœªç¶“æˆæ¬Šè«‹å‹¿è½‰è¼‰ã€‚</p>
                </footer>

            </div>
        </main>
    </div>

    <script>
        // ==========================
        // 1. Logo ä¸Šå‚³è™•ç† (è§£æ±ºåœ–ç‰‡ä¸é¡¯ç¤º)
        // ==========================
        function previewImage(input, imgId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(imgId);
                    const placeholder = document.getElementById(imgId.replace('-img', '-placeholder'));
                    
                    // é¡¯ç¤ºåœ–ç‰‡ï¼Œéš±è—ä½”ä½ç¬¦
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    if (placeholder) placeholder.classList.add('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        // ==========================
        // 2. ç‹€æ…‹ç®¡ç†
        // ==========================
        const state = {
            title: document.getElementById('input-title'),
            subtitle: document.getElementById('input-subtitle'),
            content: document.getElementById('input-content'),
            
            chartToggle: document.getElementById('toggle-chart'),
            chartLabels: [document.getElementById('chart-label-1'), document.getElementById('chart-label-2')],
            chartData: [document.getElementById('chart-data-1'), document.getElementById('chart-data-2')],
            chartCaption: document.getElementById('chart-caption'),
            
            // é è¦½å…ƒç´ 
            pTitle: document.getElementById('preview-title'),
            pSubtitle: document.getElementById('preview-subtitle'),
            pContent: document.getElementById('preview-content'),
            pChartSection: document.getElementById('preview-chart-section'),
            pChartCaption: document.getElementById('preview-chart-caption'),
            pControls: document.getElementById('chart-controls'),
        };

        let myChart = null;

        // ==========================
        // 3. åœ–è¡¨åˆå§‹åŒ–
        // ==========================
        function initChart() {
            const ctx = document.getElementById('impactChart').getContext('2d');
            Chart.defaults.font.family = '"Noto Sans TC", sans-serif';
            
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [state.chartLabels[0].value, state.chartLabels[1].value],
                    datasets: [{
                        data: [state.chartData[0].value, state.chartData[1].value],
                        backgroundColor: ['#1a3c5e', '#c49a6c'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, boxWidth: 8 } }
                    },
                    layout: { padding: 10 }
                }
            });
        }

        // ==========================
        // 4. ç•«é¢æ›´æ–° (å«ç‰ˆé¢è‡ªå‹•èª¿æ•´)
        // ==========================
        function update() {
            // æ–‡å­—åŒæ­¥
            state.pTitle.innerText = state.title.value;
            state.pSubtitle.innerText = state.subtitle.value;
            state.pContent.innerText = state.content.value;
            state.pChartCaption.innerText = state.chartCaption.value;

            // åœ–è¡¨é¡¯ç¤ºé‚è¼¯èˆ‡ç‰ˆé¢èª¿æ•´
            const showChart = state.chartToggle.checked;
            
            if (showChart) {
                // A. é¡¯ç¤ºåœ–è¡¨
                state.pChartSection.style.display = 'block';
                state.pControls.style.opacity = '1';
                state.pControls.style.pointerEvents = 'auto';

                // B. å›å¾©æ­£å¸¸æ–‡å­—æ’ç‰ˆ
                state.pContent.className = "text-justify text-gray-700 text-base leading-relaxed whitespace-pre-wrap font-sans";
                // ç¢ºä¿å‚ç›´ç½®ä¸­æˆ–é ä¸Šå–æ±ºæ–¼å…§å®¹é•·åº¦ï¼Œé€™è£¡ä¿æŒé è¨­ flex å¸ƒå±€
                
                // æ›´æ–°æ•¸æ“š
                if (myChart) {
                    myChart.data.labels = [state.chartLabels[0].value, state.chartLabels[1].value];
                    myChart.data.datasets[0].data = [state.chartData[0].value, state.chartData[1].value];
                    myChart.update();
                }

            } else {
                // A. éš±è—åœ–è¡¨
                state.pChartSection.style.display = 'none';
                state.pControls.style.opacity = '0.4';
                state.pControls.style.pointerEvents = 'none';

                // B. **è‡ªå‹•ç‰ˆé¢èª¿æ•´**ï¼šç•¶åœ–è¡¨æ¶ˆå¤±ï¼Œè®“æ–‡å­—æ›´å¯¬é¬†ã€å¤§å™¨
                // å¢åŠ å­—ç´š (text-lg)ã€å¢åŠ è¡Œé«˜ (leading-loose)ã€å¢åŠ æ®µè½é–“è·
                state.pContent.className = "text-justify text-gray-700 text-lg leading-loose whitespace-pre-wrap font-sans flex flex-col justify-center h-full";
            }
        }

        // ==========================
        // 5. äº‹ä»¶ç›£è½
        // ==========================
        document.querySelectorAll('input, textarea').forEach(el => {
            if (el.type !== 'file') el.addEventListener('input', update);
        });
        state.chartToggle.addEventListener('change', update);

        // ==========================
        // 6. åŒ¯å‡ºåŠŸèƒ½
        // ==========================
        function downloadPDF() {
            const element = document.getElementById('document-preview');
            // æš«æ™‚ç§»é™¤ border ä»¥æ±‚ PDF é‚Šç·£ä¹¾æ·¨
            const originalShadow = element.style.boxShadow;
            element.style.boxShadow = 'none';

            const opt = {
                margin: 0,
                filename: 'åœ°æ”¿æ–‡ä»¶_' + new Date().getTime() + '.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                element.style.boxShadow = originalShadow;
            });
        }

        function downloadImage() {
            const element = document.getElementById('document-preview');
            html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'åœ°æ”¿æ–‡ä»¶_' + new Date().getTime() + '.jpg';
                link.href = canvas.toDataURL('image/jpeg');
                link.click();
            });
        }

        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            initChart();
            update();
        });

    </script>
</body>
</html>