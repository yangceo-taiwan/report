<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹/æ˜“ä¸åœ°æ”¿ - å°ˆæ¥­æ–‡ä»¶ç”Ÿæˆå™¨ (ä¿®æ­£ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark': '#1a3c5e',
                        'brand-gold': '#d4af37',
                        'brand-gray': '#f8f9fa',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* ç¢ºä¿æ•´å€‹æ‡‰ç”¨ç¨‹å¼ä½”æ»¿è¢å¹•ä¸”ä¸æœƒå‡ºç¾é›™é‡æ²è»¸ */
        body { overflow: hidden; }
        
        /* ç·¨è¼¯å€æ²è»¸ç¾åŒ– */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #a0aec0; }

        /* A4 ç´™å¼µæ¨™æº–è¨­å®š */
        .a4-paper {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            /* é—œéµä¿®æ­£ï¼šé˜²æ­¢å…§å®¹æº¢å‡ºå°è‡´è·‘ç‰ˆ */
            overflow: hidden; 
        }

        /* é è¦½å€èƒŒæ™¯ç¶²æ ¼ */
        .preview-bg {
            background-color: #525659;
            background-image: radial-gradient(#6c7073 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* åœ–è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
        }

        /* é–‹é—œæŒ‰éˆ•æ¨£å¼ */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #d4af37;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #d4af37;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans h-screen flex flex-col">

    <header class="bg-brand-dark text-white h-14 flex items-center justify-between px-4 shrink-0 shadow-md z-20">
        <div class="flex items-center gap-3">
            <div class="font-bold text-lg tracking-wide">å®åœ‹/æ˜“ä¸åœ°æ”¿</div>
            <span class="text-gray-400 text-xs border-l border-gray-600 pl-3">æ–‡ä»¶ç”Ÿæˆç³»çµ± v2.0</span>
        </div>
        <div class="flex gap-2">
            <button onclick="downloadImage()" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-sm transition">
                ğŸ“· å­˜ç‚ºåœ–ç‰‡
            </button>
            <button onclick="downloadPDF()" class="px-3 py-1 bg-brand-gold hover:bg-yellow-600 text-white font-medium rounded text-sm transition shadow">
                ğŸ“„ å­˜ç‚º PDF
            </button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <aside class="w-full md:w-[380px] bg-white border-r border-gray-200 flex flex-col z-10 shadow-lg">
            <div class="p-4 bg-gray-50 border-b font-bold text-brand-dark flex items-center gap-2">
                <span>âœï¸</span> ç·¨è¼¯å…§å®¹
            </div>
            
            <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-6">
                <div class="space-y-3">
                    <label class="block text-sm font-bold text-gray-700">æ–‡ä»¶æ¨™é¡Œ</label>
                    <input type="text" id="input-title" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-brand-gold outline-none" value="å¹³å‡åœ°æ¬Šæ¢ä¾‹ä¿®æ³•é‡é»è§£æ">
                    
                    <label class="block text-sm font-bold text-gray-700">å‰¯æ¨™é¡Œ / æ—¥æœŸ</label>
                    <input type="text" id="input-subtitle" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-brand-gold outline-none" value="ä¸­è¯æ°‘åœ‹ 115 å¹´ 1 æœˆ 2 æ—¥ | æ”¿ç­–å½±éŸ¿åˆ†æ">
                </div>

                <hr>

                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">ä¸»è¦å…§å®¹</label>
                    <textarea id="input-content" rows="10" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-brand-gold outline-none leading-relaxed text-sm" placeholder="è¼¸å…¥æ³•è¦èªªæ˜...">æœ¬æ¬¡ä¿®æ³•ä¸»è¦é‡å°é å”®å±‹æ›ç´„è½‰å”®é™åˆ¶ã€ç§æ³•äººè³¼å±‹è¨±å¯åˆ¶ç­‰äº”å¤§é‡é»é€²è¡Œè¦ç¯„ã€‚

é‡å°ç§æ³•äººè³¼å±‹éƒ¨åˆ†ï¼ŒåŸå‰‡ä¸Šå°‡æ”¹æ¡è¨±å¯åˆ¶ï¼Œä¸¦é™åˆ¶å–å¾—å¾Œäº”å¹´å…§ä¸å¾—ç§»è½‰ï¼Œæ­¤èˆ‰é æœŸå°‡å¤§å¹…é™ä½è±ªå®…å¸‚å ´çš„æŠ•è³‡éœ€æ±‚ã€‚

å°æ–¼ä¸€èˆ¬è‡ªä½å®¢ç¾¤è€Œè¨€ï¼Œå¸‚å ´ä¾›çµ¦é‡å¯èƒ½æœƒå› ç‚ºæŠ•è³‡å®¢é€€å ´è€ŒçŸ­æœŸæ³¢å‹•ï¼Œä½†é•·æœŸæœ‰åŠ©æ–¼æˆ¿åƒ¹å›æ­¸ç†æ€§åŸºæœ¬é¢ã€‚å®åœ‹èˆ‡æ˜“ä¸åœ°æ”¿åœ˜éšŠå»ºè­°ï¼Œç›®å‰æŒæœ‰é å”®å±‹ä¹‹å®¢æˆ¶ï¼Œæ‡‰é‡æ–°æª¢è¦–è³‡ç”¢é…ç½®ï¼Œé¿å…é•è¦è½‰å”®å—ç½°ã€‚</textarea>
                </div>

                <hr>

                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-bold text-brand-dark">ğŸ“Š æ•¸æ“šåœ–è¡¨</span>
                        
                        <div class="relative inline-block w-10 mr-2 align-middle select-none">
                            <input type="checkbox" id="toggle-chart" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer checked:right-0 checked:border-brand-gold transition-all duration-300 z-10" checked>
                            <label for="toggle-chart" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer checked:bg-brand-gold transition-all duration-300"></label>
                        </div>
                    </div>

                    <div id="chart-settings" class="space-y-2 transition-opacity duration-200">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="chart-label-1" class="p-1 border rounded text-xs" value="è‡ªä½éœ€æ±‚">
                            <input type="number" id="chart-data-1" class="p-1 border rounded text-xs" value="65">
                            <input type="text" id="chart-label-2" class="p-1 border rounded text-xs" value="æŠ•è³‡éœ€æ±‚">
                            <input type="number" id="chart-data-2" class="p-1 border rounded text-xs" value="35">
                        </div>
                        <input type="text" id="chart-caption" class="w-full p-1 border rounded text-xs mt-2" value="åœ–è¡¨ 1ï¼šä¿®æ³•å‰å¾Œå¸‚å ´çµæ§‹ä½”æ¯”é ä¼°">
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 preview-bg overflow-auto custom-scroll p-8 flex justify-center items-start">
            
            <div id="document-preview" class="a4-paper shrink-0">
                
                <div class="px-10 py-8 border-b-4 border-brand-gold flex justify-between items-center bg-white">
                    <div class="flex items-center gap-6 h-20">
                        <div class="h-full flex items-center">
                            <img src="uploaded:æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸Logo" class="max-h-full w-auto object-contain">
                        </div>
                        
                        <div class="h-12 w-px bg-gray-300"></div>

                        <div class="h-full flex items-center">
                            <img src="uploaded:å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹Logo" class="max-h-full w-auto object-contain opacity-90">
                        </div>
                    </div>

                    <div class="text-right hidden sm:block">
                        <h2 class="text-brand-dark font-bold text-xl tracking-widest">å®åœ‹ / æ˜“ä¸åœ°æ”¿</h2>
                        <p class="text-xs text-gray-500 mt-1 font-medium">PROFESSIONAL LAND ADMINISTRATION</p>
                        <p class="text-xs text-brand-gold mt-0.5">å°ˆæ¥­ï¼èª ä¿¡ï¼æ°¸çºŒ</p>
                    </div>
                </div>

                <div class="px-12 py-10 flex-1 flex flex-col">
                    
                    <div class="text-center mb-10">
                        <h1 id="preview-title" class="text-3xl font-bold text-brand-dark mb-3">å¹³å‡åœ°æ¬Šæ¢ä¾‹ä¿®æ³•é‡é»è§£æ</h1>
                        <div class="flex justify-center items-center gap-3">
                            <span class="h-px w-8 bg-gray-300"></span>
                            <p id="preview-subtitle" class="text-sm text-gray-500 font-medium tracking-wide">ä¸­è¯æ°‘åœ‹ 115 å¹´ 1 æœˆ 2 æ—¥ | æ”¿ç­–å½±éŸ¿åˆ†æ</p>
                            <span class="h-px w-8 bg-gray-300"></span>
                        </div>
                    </div>

                    <div id="preview-content" class="text-justify text-gray-700 leading-loose text-lg whitespace-pre-wrap mb-8">
                        </div>

                    <div id="preview-chart-section" class="mt-auto mb-4 bg-gray-50 p-6 rounded-lg border border-gray-100">
                        <h3 class="text-brand-dark font-bold text-lg mb-4 border-l-4 border-brand-gold pl-3">æ•¸æ“šä½è­‰åˆ†æ</h3>
                        <div class="flex flex-col items-center">
                            <div class="chart-container">
                                <canvas id="impactChart"></canvas>
                            </div>
                            <p id="preview-chart-caption" class="text-sm text-gray-500 mt-4 italic">åœ–è¡¨èªªæ˜æ–‡å­—</p>
                        </div>
                    </div>

                </div>

                <div class="bg-brand-dark text-white text-center py-3 text-xs opacity-90 mt-auto">
                    æœ¬æ–‡ä»¶å…§å®¹ä¹‹æ™ºæ…§è²¡ç”¢æ¬Šç‚ºå®åœ‹åœ°æ”¿èˆ‡æ˜“ä¸åœ°æ”¿æ‰€æœ‰ï¼Œæœªç¶“æˆæ¬Šä¸å¾—ä»»æ„è½‰è¼‰ã€‚
                </div>

            </div>
        </main>
    </div>

    <script>
        // è®Šæ•¸
        const inputs = {
            title: document.getElementById('input-title'),
            subtitle: document.getElementById('input-subtitle'),
            content: document.getElementById('input-content'),
            chartToggle: document.getElementById('toggle-chart'),
            chartData: [
                document.getElementById('chart-label-1'),
                document.getElementById('chart-data-1'),
                document.getElementById('chart-label-2'),
                document.getElementById('chart-data-2')
            ],
            caption: document.getElementById('chart-caption')
        };

        const previews = {
            title: document.getElementById('preview-title'),
            subtitle: document.getElementById('preview-subtitle'),
            content: document.getElementById('preview-content'),
            chartSection: document.getElementById('preview-chart-section'),
            chartCaption: document.getElementById('preview-chart-caption'),
            settings: document.getElementById('chart-settings')
        };

        let chartInstance = null;

        // åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('impactChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [inputs.chartData[0].value, inputs.chartData[2].value],
                    datasets: [{
                        data: [inputs.chartData[1].value, inputs.chartData[3].value],
                        backgroundColor: ['#1a3c5e', '#d4af37'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { family: "'Noto Sans TC'" } } }
                    }
                }
            });
        }

        // æ›´æ–°ç•«é¢
        function update() {
            // æ–‡å­—æ›´æ–°
            previews.title.innerText = inputs.title.value;
            previews.subtitle.innerText = inputs.subtitle.value;
            previews.content.innerText = inputs.content.value;
            previews.chartCaption.innerText = inputs.caption.value;

            // åœ–è¡¨é–‹é—œé‚è¼¯
            if (inputs.chartToggle.checked) {
                previews.chartSection.style.display = 'block';
                previews.settings.style.opacity = '1';
                previews.settings.style.pointerEvents = 'auto';
                
                // æ›´æ–°åœ–è¡¨æ•¸æ“š
                if (chartInstance) {
                    chartInstance.data.labels = [inputs.chartData[0].value, inputs.chartData[2].value];
                    chartInstance.data.datasets[0].data = [inputs.chartData[1].value, inputs.chartData[3].value];
                    chartInstance.update();
                }
            } else {
                previews.chartSection.style.display = 'none';
                previews.settings.style.opacity = '0.4';
                previews.settings.style.pointerEvents = 'none';
            }
        }

        // ç¶å®šäº‹ä»¶
        document.querySelectorAll('input, textarea').forEach(el => el.addEventListener('input', update));
        inputs.chartToggle.addEventListener('change', update);

        // ä¸‹è¼‰åŠŸèƒ½
        function downloadPDF() {
            const el = document.getElementById('document-preview');
            const opt = {
                margin: 0,
                filename: 'å®åœ‹æ˜“ä¸æ–‡ä»¶.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            // æš«æ™‚é–å®šé«˜åº¦é¿å…è·‘ç‰ˆ
            const oldHeight = el.style.height;
            el.style.height = '297mm';
            html2pdf().set(opt).from(el).save().then(() => el.style.height = oldHeight);
        }

        function downloadImage() {
            const el = document.getElementById('document-preview');
            const oldHeight = el.style.height;
            el.style.height = '297mm';
            
            html2canvas(el, { scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'å®åœ‹æ˜“ä¸æ–‡ä»¶.jpg';
                link.href = canvas.toDataURL('image/jpeg');
                link.click();
                el.style.height = oldHeight;
            });
        }

        // å•Ÿå‹•
        window.addEventListener('DOMContentLoaded', () => {
            initChart();
            update();
        });
    </script>
</body>
</html>